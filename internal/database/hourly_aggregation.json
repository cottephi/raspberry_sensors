[{"apiVersion":"influxdata.com/v2alpha1","kind":"Task","metadata":{"name":"pensive-northcutt-99d001"},"spec":{"cron":"0 * * * *","name":"Hourly aggregation","query":"import \"date\"\nimport \"strings\"\nimport \"array\"\n\n\n\nstartOfToday = today()\nstartOfTomorrow = date.add(d: 1d, to: today())\n\ndailyAggregation = (aggregateFunction, suffix) => {\n    return\n        from(bucket: \"seconds\")\n            |> range(start: startOfToday)\n            // Adjust for your data retention policy\n            |> filter(fn: (r) => r._measurement == \"environment_bme280\")\n            // Filter by measurement\n            |> aggregateFunction()\n            |> map(\n                fn: (r) =>\n                    ({r with _field: strings.joinStr(arr: [r._field, suffix], v: \"\"),\n                        _time: startOfTomorrow,\n                    }),\n            )//|> pivot(rowKey:[\"_time\"], columnKey: [\"_field\"], valueColumn: \"_value\")\n\n}\n\ndailyAggregation(aggregateFunction: mean, suffix: \"_mean\")\n    |> to(bucket: \"daily\")\ndailyAggregation(aggregateFunction: median, suffix: \"_median\")\n    |> to(bucket: \"daily\")\ndailyAggregation(aggregateFunction: stddev, suffix: \"_stddev\")\n    |> to(bucket: \"daily\")"}}]